import{m as M,c as r,o as a,a as o,b as g,y as R,t as x,s as p,x as $,F as V,D as E,p as T,r as w,i as L,A as P,e as j}from"./app-CQqk7krA.js";import{p as f}from"./personaService-BcRaQCsB.js";const z={class:"flex flex-col items-center"},I={class:"text-lg font-bold text-gray-900 dark:text-white text-center mb-2"},S={class:"text-xs text-gray-600 dark:text-gray-400 space-y-1"},D={key:0,class:"flex items-center gap-1"},F={key:1,class:"flex items-center gap-1"},G={key:2,class:"flex items-center gap-1 text-red-600 dark:text-red-400"},q={key:0,class:"absolute left-1/2 transform -translate-x-1/2 w-0.5 bg-gray-400 dark:bg-gray-600",style:{top:"100%",height:"40px",marginTop:"16px"}},H={key:0,class:"flex flex-row items-start gap-8 relative",style:{marginTop:"40px"}},O={key:0,class:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 bg-gray-400 dark:bg-gray-600",style:{top:"-20px",height:"20px"}},U={__name:"TreeNode",props:{node:{type:Object,required:!0},level:{type:Number,default:0}},emits:["navigate"],setup(e){const m=s=>{if(!s)return"-";try{const t=new Date(s);if(isNaN(t.getTime()))return s;const d=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),y=t.getFullYear();return`${d}/${l}/${y}`}catch{return s}};return(s,t)=>{const d=M("TreeNode",!0);return a(),r("div",z,[o("div",{class:"relative mb-4",style:$({marginLeft:(e.level>0,"0")})},[o("div",{onClick:t[0]||(t[0]=l=>s.$emit("navigate",e.node.id)),class:R(["bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 min-w-[200px] max-w-[250px] cursor-pointer hover:shadow-xl transition-all transform hover:scale-105 border-2 border-blue-500 dark:border-blue-400",{"border-green-500 dark:border-green-400":e.level>0,"border-purple-500 dark:border-purple-400":e.level>1}])},[o("h3",I,x(e.node.nome_completo||`${e.node.nome} ${e.node.cognome}`),1),o("div",S,[e.node.nato_il?(a(),r("div",D,[t[2]||(t[2]=o("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),p(" "+x(m(e.node.nato_il)),1)])):g("",!0),e.node.nato_a?(a(),r("div",F,[t[3]||(t[3]=o("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),p(" "+x(e.node.nato_a),1)])):g("",!0),e.node.deceduto_il?(a(),r("div",G,[t[4]||(t[4]=o("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),p(" "+x(m(e.node.deceduto_il)),1)])):g("",!0)])],2),e.node.figli&&e.node.figli.length>0?(a(),r("div",q)):g("",!0)],4),e.node.figli&&e.node.figli.length>0?(a(),r("div",H,[o("div",{class:"absolute top-0 left-0 right-0 h-0.5 bg-gray-400 dark:bg-gray-600",style:$({top:"-20px",left:e.node.figli.length>1?"0":"50%",right:e.node.figli.length>1?"0":"50%",width:e.node.figli.length>1?"100%":"0"})},null,4),e.node.figli.length>1?(a(),r("div",O)):g("",!0),(a(!0),r(V,null,E(e.node.figli,(l,y)=>(a(),r("div",{key:l.id,class:"relative flex flex-col items-center"},[t[5]||(t[5]=o("div",{class:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 bg-gray-400 dark:bg-gray-600",style:{top:"-20px",height:"20px"}},null,-1)),T(d,{node:l,level:e.level+1,onNavigate:t[1]||(t[1]=h=>s.$emit("navigate",h))},null,8,["node","level"])]))),128))])):g("",!0)])}}},Y={class:"bg-gray-50 dark:bg-gray-900 py-8"},J={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},K={class:"mb-6 flex justify-between items-center"},Q={key:0,class:"text-center py-12"},W={key:1,class:"bg-red-100 dark:bg-red-900 border border-red-400 text-red-700 dark:text-red-300 px-4 py-3 rounded"},X={key:2,class:"overflow-x-auto"},Z={class:"inline-block min-w-full"},_={class:"flex flex-col items-center py-8"},oe={__name:"Tree",setup(e){const m=P(),s=j(),t=w(!0),d=w(null),l=w(null),y=async()=>{var u,i,b;t.value=!0,d.value=null;try{let n=null;if(m.params.id)n=(await f.getById(m.params.id)).data;else{const k=await f.getAllPeople();let c=k.data;Array.isArray(c)||(c=(c==null?void 0:c.data)||[]),Array.isArray(c)||(console.warn("Risposta API non valida:",k),c=[]),n=c.find(v=>{if(!v)return!1;const N=(v.cognome||"").toLowerCase(),A=(v.nome||"").toLowerCase(),B=(v.nome_completo||"").toLowerCase();return N.includes("mistretta")&&A.includes("giuseppe")||B.includes("mistretta giuseppe")}),n||(n=((u=(await f.getAllForTree()).data)==null?void 0:u.radice)||null)}if(!n||!n.id)throw new Error('Persona radice non trovata. Verifica che "MISTRETTA GIUSEPPE sen." esista nel database.');const C=await f.getTreeFromPerson(n.id);l.value=C.data}catch(n){d.value=((b=(i=n.response)==null?void 0:i.data)==null?void 0:b.message)||n.message||"Errore nel caricamento dell'albero genealogico",console.error("Errore:",n)}finally{t.value=!1}},h=u=>{s.push(`/persone/${u}`)};return L(()=>{y()}),(u,i)=>(a(),r("div",Y,[o("div",J,[o("div",K,[i[1]||(i[1]=o("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"Albero Genealogico",-1)),o("button",{onClick:i[0]||(i[0]=b=>u.$router.push("/persone")),class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Torna alla Lista ")]),t.value?(a(),r("div",Q,[...i[2]||(i[2]=[o("p",{class:"text-gray-600 dark:text-gray-400"},"Caricamento albero genealogico...",-1)])])):d.value?(a(),r("div",W,x(d.value),1)):l.value?(a(),r("div",X,[o("div",Z,[o("div",_,[T(U,{node:l.value,level:0,onNavigate:h},null,8,["node"])])])])):g("",!0)])]))}};export{oe as default};
