import{h as de,i as K,r as m,B as T,A as ne,c as _,a as e,b as ie,g as E,t as d,d as c,v as b,p as j,q as x,F as q,D as R,m as se,w as ue,e as pe,o as k,s as B,j as ge}from"./app-Db2intbC.js";import{u as me}from"./persone-37GW1075.js";import{p as I}from"./personaService-p9cadlBs.js";import{t as ce}from"./tipoLegameService-CAo23vmP.js";import{t as be,_ as N}from"./SearchableSelect-_A4h7WCA.js";const xe={key:0,class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},ve={class:"flex items-start gap-3"},ye={class:"text-sm font-medium text-blue-900 dark:text-blue-300"},_e={class:"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6"},ke={class:"space-y-6"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"space-y-2"},he={class:"flex items-center gap-2"},Ce={class:"flex-1 text-sm font-semibold text-gray-900 dark:text-white"},ze=["onClick"],Ve={class:"grid grid-cols-1 md:grid-cols-3 gap-2 mt-2"},Ue={class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},Me=["onUpdate:modelValue"],Pe={value:""},Se=["value"],je={class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},Be=["onUpdate:modelValue"],Ie={class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},Le=["onUpdate:modelValue","placeholder"],Ae={class:"grid grid-cols-1 md:grid-cols-2 gap-2 mt-2 pt-2 border-t border-purple-200 dark:border-purple-800"},De={class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},Ee=["onUpdate:modelValue"],Ne={class:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1"},Fe=["onUpdate:modelValue","placeholder"],Te=["disabled"],qe={class:"space-y-2"},Re={class:"flex-1 text-sm text-gray-900 dark:text-white"},He=["onClick"],Oe=["disabled"],$e={class:"flex space-x-4"},Ge=["disabled"],Ze={__name:"Create",setup(Je){const v=ne(),C=pe(),Q=me(),F=de(),y=l=>F.t(l);K(()=>{Object.keys(F.translations).length===0&&F.loadTranslations()});const s=m({nome:"",cognome:"",nato_a:"",nato_il:"",deceduto_a:"",deceduto_il:""}),L=m(!1),f=m([]),H=m([]),O=m([]),A=m(""),D=m(""),z=m([]),V=m([]),U=m(""),M=m(""),$=T(()=>z.value.map(l=>{var t;return l.id||((t=l.persona)==null?void 0:t.id)})),G=T(()=>V.value.map(l=>l.id)),P=T(()=>[...O.value].sort((l,t)=>{const n=(l.cognome||"").toLowerCase(),o=(t.cognome||"").toLowerCase();if(n!==o)return n.localeCompare(o,"it");const a=(l.nome||"").toLowerCase(),i=(t.nome||"").toLowerCase();return a.localeCompare(i,"it")})),w=v.query.relazione_persona_id?parseInt(v.query.relazione_persona_id):null,h=v.query.relazione_tipo,J=v.query.return_to||"/persone";K(async()=>{try{const[l,t,n]=await Promise.all([ce.getAll(),be.getAll(),I.getAllPeople()]);f.value=l.data.data||l.data||[],H.value=t.data||[],O.value=n.data.data||n.data||[],w&&h&&(h==="coniuge"?z.value=[{id:w,nome_completo:"Persona originale",data_legame:"",luogo_legame:"",tipo_evento_legame_id:"",data_separazione:"",luogo_separazione:""}]:h==="figlio"&&(V.value=[{id:w,nome_completo:"Persona originale"}]))}catch(l){console.error("Errore nel caricamento dei dati:",l)}});const W=async()=>{L.value=!0;try{const l={};A.value&&(l.padre_id=parseInt(A.value)),D.value&&(l.madre_id=parseInt(D.value));const t=[],n=f.value.find(r=>r.nome==="coniuge");n&&z.value.forEach(r=>{var S;const u={persona_collegata_id:r.id||((S=r.persona)==null?void 0:S.id),tipo_legame_id:n.id};r.data_legame&&(u.data_legame=r.data_legame),r.luogo_legame&&(u.luogo_legame=r.luogo_legame),r.tipo_evento_legame_id&&(u.tipo_evento_legame_id=parseInt(r.tipo_evento_legame_id)),r.data_separazione&&(u.data_separazione=r.data_separazione),r.luogo_separazione&&(u.luogo_separazione=r.luogo_separazione),t.push(u)});const o=f.value.find(r=>r.nome==="padre");o&&V.value.forEach(r=>{t.push({persona_collegata_id:r.id,tipo_legame_id:o.id})});const a={...s.value};Object.keys(l).length>0&&(a.genitori=l),t.length>0&&(a.relazioni=t);const i=await Q.createPersona(a);if(i.success&&i.data&&i.data.id){const r=i.data.id;w&&h&&!t.find(u=>u.persona_collegata_id===w)&&await le(w,r,h),C.push(J)}else C.push("/persone")}catch(l){console.error("Errore nel salvataggio:",l)}finally{L.value=!1}},X=()=>{if(!U.value)return;const l=P.value.find(t=>t.id===parseInt(U.value));l&&!$.value.includes(l.id)&&(z.value.push({id:l.id,nome_completo:l.nome_completo,persona:l,data_legame:"",luogo_legame:"",tipo_evento_legame_id:"",data_separazione:"",luogo_separazione:""}),U.value="")},Y=l=>{z.value.splice(l,1)},Z=()=>{if(!M.value)return;const l=P.value.find(t=>t.id===parseInt(M.value));l&&!G.value.includes(l.id)&&(V.value.push(l),M.value="")},ee=l=>{V.value.splice(l,1)},te=()=>{C.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"padre",return_to:v.fullPath}})},oe=()=>{C.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"madre",return_to:v.fullPath}})},ae=()=>{C.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"coniuge",return_to:v.fullPath}})},re=()=>{C.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"figlio",return_to:v.fullPath}})},le=async(l,t,n)=>{try{const a=(await I.getById(l)).data,i={};a.padre&&(i.padre_id=a.padre.id),a.madre&&(i.madre_id=a.madre.id);const r=[];if(a.consorti&&Array.isArray(a.consorti)){const p=f.value.find(g=>g.nome==="coniuge");p&&a.consorti.forEach(g=>{r.push({persona_collegata_id:g.id,tipo_legame_id:p.id})})}if(a.figli&&Array.isArray(a.figli)){const p=f.value.find(g=>g.nome==="padre");p&&a.figli.forEach(g=>{r.push({persona_collegata_id:g.id,tipo_legame_id:p.id})})}let u=null;if(n==="coniuge"){const p=f.value.find(g=>g.nome==="coniuge");u=p?p.id:null}else if(n==="figlio"){const p=f.value.find(g=>g.nome==="padre");u=p?p.id:null}else if(n==="padre"){await I.update(l,{nome:a.nome,cognome:a.cognome,nato_a:a.nato_a,nato_il:a.nato_il,deceduto_a:a.deceduto_a,deceduto_il:a.deceduto_il,genitori:{...a.padre?{padre_id:a.padre.id}:{},...a.madre?{madre_id:a.madre.id}:{},padre_id:t}});return}else if(n==="madre"){await I.update(l,{nome:a.nome,cognome:a.cognome,nato_a:a.nato_a,nato_il:a.nato_il,deceduto_a:a.deceduto_a,deceduto_il:a.deceduto_il,genitori:{...a.padre?{padre_id:a.padre.id}:{},...a.madre?{madre_id:a.madre.id}:{},madre_id:t}});return}u&&r.push({persona_collegata_id:t,tipo_legame_id:u});const S={nome:a.nome,cognome:a.cognome,nato_a:a.nato_a,nato_il:a.nato_il,deceduto_a:a.deceduto_a,deceduto_il:a.deceduto_il};Object.keys(i).length>0&&(S.genitori=i),r.length>0&&(S.relazioni=r),await I.update(l,S)}catch(o){console.error("Errore nella creazione della relazione:",o)}};return(l,t)=>{const n=se("router-link");return k(),_("div",null,[t[33]||(t[33]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-6"},"Crea Persona",-1)),E(w)&&E(h)?(k(),_("div",xe,[e("div",ve,[t[11]||(t[11]=e("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[e("p",ye," Stai creando un nuovo "+d(E(h)==="coniuge"?"consorte":"figlio"),1),t[10]||(t[10]=e("p",{class:"text-sm text-blue-700 dark:text-blue-400 mt-1"}," Dopo il salvataggio, tornerai automaticamente alla pagina di modifica della persona originale e la nuova persona sarà già collegata. ",-1))])])])):ie("",!0),e("form",{onSubmit:ue(W,["prevent"]),class:"max-w-2xl space-y-4"},[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nome",-1)),c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.nome=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[b,s.value.nome]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Cognome",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.cognome=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[b,s.value.cognome]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nato a",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.nato_a=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[b,s.value.nato_a]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nato il",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.nato_il=o),type:"date",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[b,s.value.nato_il]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Deceduto a",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.deceduto_a=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[b,s.value.deceduto_a]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Deceduto il",-1)),c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.deceduto_il=o),type:"date",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[b,s.value.deceduto_il]])]),e("div",_e,[t[31]||(t[31]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Relazioni Familiari",-1)),e("div",ke,[e("div",null,[t[22]||(t[22]=e("div",{class:"flex items-center justify-between mb-3"},[e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide"},"Genitori")],-1)),e("div",fe,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Padre",-1)),j(N,{modelValue:A.value,"onUpdate:modelValue":t[6]||(t[6]=o=>A.value=o),options:P.value,"option-label":"nome_completo","option-value":"id",placeholder:"Cerca padre per nome o cognome...","empty-option":"Seleziona padre esistente...","select-class":"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},{option:x(({option:o})=>[B(d(o.nome_completo)+" (ID: "+d(o.id)+") ",1)]),actions:x(()=>[e("button",{type:"button",onClick:te,class:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm",title:"Crea nuovo padre"},[...t[18]||(t[18]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),_:1},8,["modelValue","options"])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Madre",-1)),j(N,{modelValue:D.value,"onUpdate:modelValue":t[7]||(t[7]=o=>D.value=o),options:P.value,"option-label":"nome_completo","option-value":"id",placeholder:"Cerca madre per nome o cognome...","empty-option":"Seleziona madre esistente...","select-class":"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},{option:x(({option:o})=>[B(d(o.nome_completo)+" (ID: "+d(o.id)+") ",1)]),actions:x(()=>[e("button",{type:"button",onClick:oe,class:"px-3 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition-colors text-sm",title:"Crea nuova madre"},[...t[20]||(t[20]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),_:1},8,["modelValue","options"])])])]),e("div",null,[t[26]||(t[26]=e("div",{class:"flex items-center justify-between mb-3"},[e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide"},"Consorti")],-1)),e("div",we,[(k(!0),_(q,null,R(z.value,(o,a)=>{var i;return k(),_("div",{key:a,class:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-md space-y-2"},[e("div",he,[e("span",Ce,d(o.nome_completo||((i=o.persona)==null?void 0:i.nome_completo)),1),e("button",{type:"button",onClick:r=>Y(a),class:"p-1 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded"},[...t[23]||(t[23]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,ze)]),e("div",Ve,[e("div",null,[e("label",Ue,d(y("persona.tipo_evento_legame")),1),c(e("select",{"onUpdate:modelValue":r=>o.tipo_evento_legame_id=r,class:"w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},[e("option",Pe,d(y("persona.select")),1),(k(!0),_(q,null,R(H.value,r=>(k(),_("option",{key:r.id,value:r.id},d(r.descrizione||r.nome),9,Se))),128))],8,Me),[[ge,o.tipo_evento_legame_id]])]),e("div",null,[e("label",je,d(y("persona.data_legame")),1),c(e("input",{"onUpdate:modelValue":r=>o.data_legame=r,type:"date",class:"w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,8,Be),[[b,o.data_legame]])]),e("div",null,[e("label",Ie,d(y("persona.luogo_legame")),1),c(e("input",{"onUpdate:modelValue":r=>o.luogo_legame=r,type:"text",class:"w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:y("persona.birth_place_example")},null,8,Le),[[b,o.luogo_legame]])])]),e("div",Ae,[e("div",null,[e("label",De,d(y("persona.data_separazione")),1),c(e("input",{"onUpdate:modelValue":r=>o.data_separazione=r,type:"date",class:"w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,8,Ee),[[b,o.data_separazione]])]),e("div",null,[e("label",Ne,d(y("persona.luogo_separazione")),1),c(e("input",{"onUpdate:modelValue":r=>o.luogo_separazione=r,type:"text",class:"w-full px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:y("persona.birth_place_example")},null,8,Fe),[[b,o.luogo_separazione]])])])])}),128)),j(N,{modelValue:U.value,"onUpdate:modelValue":t[8]||(t[8]=o=>U.value=o),options:P.value,"option-label":"nome_completo","option-value":"id",placeholder:"Cerca consorte per nome o cognome...","empty-option":"Seleziona consorte esistente...",disabled:$.value,"select-class":"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},{option:x(({option:o})=>[B(d(o.nome_completo)+" (ID: "+d(o.id)+") ",1)]),actions:x(()=>[e("button",{type:"button",onClick:X,disabled:!U.value,class:"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm"},[...t[24]||(t[24]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,Te),e("button",{type:"button",onClick:ae,class:"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm",title:"Crea nuovo consorte"},[...t[25]||(t[25]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),_:1},8,["modelValue","options","disabled"])])]),e("div",null,[t[30]||(t[30]=e("div",{class:"flex items-center justify-between mb-3"},[e("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide"},"Figli")],-1)),e("div",qe,[(k(!0),_(q,null,R(V.value,(o,a)=>(k(),_("div",{key:a,class:"flex items-center gap-2 p-2 bg-green-50 dark:bg-green-900/20 rounded-md"},[e("span",Re,d(o.nome_completo),1),e("button",{type:"button",onClick:i=>ee(a),class:"p-1 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded"},[...t[27]||(t[27]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,He)]))),128)),j(N,{modelValue:M.value,"onUpdate:modelValue":t[9]||(t[9]=o=>M.value=o),options:P.value,"option-label":"nome_completo","option-value":"id",placeholder:"Cerca figlio per nome o cognome...","empty-option":"Seleziona figlio esistente...",disabled:G.value,"select-class":"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},{option:x(({option:o})=>[B(d(o.nome_completo)+" (ID: "+d(o.id)+") ",1)]),actions:x(()=>[e("button",{type:"button",onClick:Z,disabled:!M.value,class:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm"},[...t[28]||(t[28]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,Oe),e("button",{type:"button",onClick:re,class:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm",title:"Crea nuovo figlio"},[...t[29]||(t[29]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])]),_:1},8,["modelValue","options","disabled"])])])])]),e("div",$e,[e("button",{type:"submit",disabled:L.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},d(L.value?"Salvataggio...":"Salva"),9,Ge),j(n,{to:E(J),class:"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-900 dark:text-white rounded-lg hover:bg-gray-400 dark:hover:bg-gray-700"},{default:x(()=>[...t[32]||(t[32]=[B(" Annulla ",-1)])]),_:1},8,["to"])])],32)])}}};export{Ze as default};
