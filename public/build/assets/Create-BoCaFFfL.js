import{r as c,x as F,s as Z,i as ee,c as d,a as t,b as te,g as A,t as p,d as b,v as P,j as N,F as j,z as B,n as oe,p as re,m as ae,w as le,e as de,o as i,q as ie}from"./app-CVxkeOic.js";import{u as ne}from"./persone-B7qbsWqt.js";import{p as S}from"./personaService-iYiy0aNM.js";import{t as se}from"./tipoLegameService-rEorDjCv.js";const ue={key:0,class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},pe={class:"flex items-start gap-3"},ge={class:"text-sm font-medium text-blue-900 dark:text-blue-300"},me={class:"border-t border-gray-200 dark:border-gray-700 pt-6 mt-6"},ce={class:"space-y-6"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ve={class:"flex gap-2"},xe=["value"],ye={class:"flex gap-2"},ke=["value"],fe={class:"space-y-2"},we={class:"flex-1 text-sm text-gray-900 dark:text-white"},_e=["onClick"],he={class:"flex gap-2"},Ce=["value","disabled"],ze=["disabled"],Me={class:"space-y-2"},Pe={class:"flex-1 text-sm text-gray-900 dark:text-white"},je=["onClick"],Be={class:"flex gap-2"},Se=["value","disabled"],Ie=["disabled"],Ve={class:"flex space-x-4"},Le=["disabled"],qe={__name:"Create",setup(Ae){const v=Z(),f=de(),R=ne(),n=c({nome:"",cognome:"",nato_a:"",nato_il:"",deceduto_a:"",deceduto_il:""}),I=c(!1),x=c([]),U=c([]),V=c(""),L=c(""),w=c([]),_=c([]),h=c(""),C=c(""),q=F(()=>w.value.map(a=>a.id)),T=F(()=>_.value.map(a=>a.id)),z=F(()=>[...U.value].sort((a,e)=>{const u=(a.cognome||"").toLowerCase(),o=(e.cognome||"").toLowerCase();if(u!==o)return u.localeCompare(o,"it");const r=(a.nome||"").toLowerCase(),s=(e.nome||"").toLowerCase();return r.localeCompare(s,"it")})),y=v.query.relazione_persona_id?parseInt(v.query.relazione_persona_id):null,k=v.query.relazione_tipo,E=v.query.return_to||"/persone";ee(async()=>{try{const[a,e]=await Promise.all([se.getAll(),S.getAllPeople()]);x.value=a.data.data||a.data||[],U.value=e.data.data||e.data||[],y&&k&&(k==="coniuge"?w.value=[{id:y,nome_completo:"Persona originale"}]:k==="figlio"&&(_.value=[{id:y,nome_completo:"Persona originale"}]))}catch(a){console.error("Errore nel caricamento dei dati:",a)}});const H=async()=>{I.value=!0;try{const a={};V.value&&(a.padre_id=parseInt(V.value)),L.value&&(a.madre_id=parseInt(L.value));const e=[],u=x.value.find(l=>l.nome==="coniuge");u&&w.value.forEach(l=>{e.push({persona_collegata_id:l.id,tipo_legame_id:u.id})});const o=x.value.find(l=>l.nome==="padre");o&&_.value.forEach(l=>{e.push({persona_collegata_id:l.id,tipo_legame_id:o.id})});const r={...n.value};Object.keys(a).length>0&&(r.genitori=a),e.length>0&&(r.relazioni=e);const s=await R.createPersona(r);if(s.success&&s.data&&s.data.id){const l=s.data.id;y&&k&&!e.find(M=>M.persona_collegata_id===y)&&await Y(y,l,k),f.push(E)}else f.push("/persone")}catch(a){console.error("Errore nel salvataggio:",a)}finally{I.value=!1}},O=()=>{if(!h.value)return;const a=z.value.find(e=>e.id===parseInt(h.value));a&&!q.value.includes(a.id)&&(w.value.push(a),h.value="")},$=a=>{w.value.splice(a,1)},G=()=>{if(!C.value)return;const a=z.value.find(e=>e.id===parseInt(C.value));a&&!T.value.includes(a.id)&&(_.value.push(a),C.value="")},J=a=>{_.value.splice(a,1)},K=()=>{f.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"padre",return_to:v.fullPath}})},Q=()=>{f.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"madre",return_to:v.fullPath}})},W=()=>{f.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"coniuge",return_to:v.fullPath}})},X=()=>{f.push({path:"/persone/create",query:{relazione_persona_id:null,relazione_tipo:"figlio",return_to:v.fullPath}})},Y=async(a,e,u)=>{try{const r=(await S.getById(a)).data,s={};r.padre&&(s.padre_id=r.padre.id),r.madre&&(s.madre_id=r.madre.id);const l=[];if(r.consorti&&Array.isArray(r.consorti)){const g=x.value.find(m=>m.nome==="coniuge");g&&r.consorti.forEach(m=>{l.push({persona_collegata_id:m.id,tipo_legame_id:g.id})})}if(r.figli&&Array.isArray(r.figli)){const g=x.value.find(m=>m.nome==="padre");g&&r.figli.forEach(m=>{l.push({persona_collegata_id:m.id,tipo_legame_id:g.id})})}let M=null;if(u==="coniuge"){const g=x.value.find(m=>m.nome==="coniuge");M=g?g.id:null}else if(u==="figlio"){const g=x.value.find(m=>m.nome==="padre");M=g?g.id:null}else if(u==="padre"){await S.update(a,{nome:r.nome,cognome:r.cognome,nato_a:r.nato_a,nato_il:r.nato_il,deceduto_a:r.deceduto_a,deceduto_il:r.deceduto_il,genitori:{...r.padre?{padre_id:r.padre.id}:{},...r.madre?{madre_id:r.madre.id}:{},padre_id:e}});return}else if(u==="madre"){await S.update(a,{nome:r.nome,cognome:r.cognome,nato_a:r.nato_a,nato_il:r.nato_il,deceduto_a:r.deceduto_a,deceduto_il:r.deceduto_il,genitori:{...r.padre?{padre_id:r.padre.id}:{},...r.madre?{madre_id:r.madre.id}:{},madre_id:e}});return}M&&l.push({persona_collegata_id:e,tipo_legame_id:M});const D={nome:r.nome,cognome:r.cognome,nato_a:r.nato_a,nato_il:r.nato_il,deceduto_a:r.deceduto_a,deceduto_il:r.deceduto_il};Object.keys(s).length>0&&(D.genitori=s),l.length>0&&(D.relazioni=l),await S.update(a,D)}catch(o){console.error("Errore nella creazione della relazione:",o)}};return(a,e)=>{const u=ae("router-link");return i(),d("div",null,[e[37]||(e[37]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-6"},"Crea Persona",-1)),A(y)&&A(k)?(i(),d("div",ue,[t("div",pe,[e[11]||(e[11]=t("svg",{class:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("div",null,[t("p",ge," Stai creando un nuovo "+p(A(k)==="coniuge"?"consorte":"figlio"),1),e[10]||(e[10]=t("p",{class:"text-sm text-blue-700 dark:text-blue-400 mt-1"}," Dopo il salvataggio, tornerai automaticamente alla pagina di modifica della persona originale e la nuova persona sarà già collegata. ",-1))])])])):te("",!0),t("form",{onSubmit:le(H,["prevent"]),class:"max-w-2xl space-y-4"},[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nome",-1)),b(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.nome=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[P,n.value.nome]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Cognome",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.cognome=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[P,n.value.cognome]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nato a",-1)),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.nato_a=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[P,n.value.nato_a]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nato il",-1)),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.nato_il=o),type:"date",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[P,n.value.nato_il]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Deceduto a",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.deceduto_a=o),type:"text",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[P,n.value.deceduto_a]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Deceduto il",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.deceduto_il=o),type:"date",class:"mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},null,512),[[P,n.value.deceduto_il]])]),t("div",me,[e[35]||(e[35]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},"Relazioni Familiari",-1)),t("div",ce,[t("div",null,[e[24]||(e[24]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide"},"Genitori")],-1)),t("div",be,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Padre",-1)),t("div",ve,[b(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},[e[18]||(e[18]=t("option",{value:""},"Seleziona padre esistente...",-1)),(i(!0),d(j,null,B(z.value,o=>(i(),d("option",{key:o.id,value:o.id},p(o.nome_completo)+" (ID: "+p(o.id)+") ",9,xe))),128))],512),[[N,V.value]]),t("button",{type:"button",onClick:K,class:"px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm",title:"Crea nuovo padre"},[...e[19]||(e[19]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Madre",-1)),t("div",ye,[b(t("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>L.value=o),class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},[e[21]||(e[21]=t("option",{value:""},"Seleziona madre esistente...",-1)),(i(!0),d(j,null,B(z.value,o=>(i(),d("option",{key:o.id,value:o.id},p(o.nome_completo)+" (ID: "+p(o.id)+") ",9,ke))),128))],512),[[N,L.value]]),t("button",{type:"button",onClick:Q,class:"px-3 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 transition-colors text-sm",title:"Crea nuova madre"},[...e[22]||(e[22]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])])])])]),t("div",null,[e[29]||(e[29]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide"},"Consorti")],-1)),t("div",fe,[(i(!0),d(j,null,B(w.value,(o,r)=>(i(),d("div",{key:r,class:"flex items-center gap-2 p-2 bg-purple-50 dark:bg-purple-900/20 rounded-md"},[t("span",we,p(o.nome_completo),1),t("button",{type:"button",onClick:s=>$(r),class:"p-1 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded"},[...e[25]||(e[25]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,_e)]))),128)),t("div",he,[b(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>h.value=o),class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},[e[26]||(e[26]=t("option",{value:""},"Seleziona consorte esistente...",-1)),(i(!0),d(j,null,B(z.value,o=>(i(),d("option",{key:o.id,value:o.id,disabled:q.value.includes(o.id)},p(o.nome_completo)+" (ID: "+p(o.id)+") ",9,Ce))),128))],512),[[N,h.value]]),t("button",{type:"button",onClick:O,disabled:!h.value,class:"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm"},[...e[27]||(e[27]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,ze),t("button",{type:"button",onClick:W,class:"px-3 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm",title:"Crea nuovo consorte"},[...e[28]||(e[28]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])])])]),t("div",null,[e[34]||(e[34]=t("div",{class:"flex items-center justify-between mb-3"},[t("h3",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300 uppercase tracking-wide"},"Figli")],-1)),t("div",Me,[(i(!0),d(j,null,B(_.value,(o,r)=>(i(),d("div",{key:r,class:"flex items-center gap-2 p-2 bg-green-50 dark:bg-green-900/20 rounded-md"},[t("span",Pe,p(o.nome_completo),1),t("button",{type:"button",onClick:s=>J(r),class:"p-1 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 rounded"},[...e[30]||(e[30]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,je)]))),128)),t("div",Be,[b(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>C.value=o),class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm"},[e[31]||(e[31]=t("option",{value:""},"Seleziona figlio esistente...",-1)),(i(!0),d(j,null,B(z.value,o=>(i(),d("option",{key:o.id,value:o.id,disabled:T.value.includes(o.id)},p(o.nome_completo)+" (ID: "+p(o.id)+") ",9,Se))),128))],512),[[N,C.value]]),t("button",{type:"button",onClick:G,disabled:!C.value,class:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm"},[...e[32]||(e[32]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,Ie),t("button",{type:"button",onClick:X,class:"px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm",title:"Crea nuovo figlio"},[...e[33]||(e[33]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])])])])])])]),t("div",Ve,[t("button",{type:"submit",disabled:I.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},p(I.value?"Salvataggio...":"Salva"),9,Le),oe(u,{to:A(E),class:"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-900 dark:text-white rounded-lg hover:bg-gray-400 dark:hover:bg-gray-700"},{default:re(()=>[...e[36]||(e[36]=[ie(" Annulla ",-1)])]),_:1},8,["to"])])],32)])}}};export{qe as default};
