import{r as b,i as F,E as V,l as D,c as s,a as e,b as d,d as C,L as T,k as N,y as f,t as l,s as v,F as S,D as U,x as j,o as a}from"./app-C8pxP4al.js";const q={class:"container mx-auto px-4 py-8"},E={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6"},R={class:"mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg"},L={class:"flex gap-4"},I={class:"flex items-center"},G={class:"flex items-center"},J={key:0,class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},K={key:0,class:"text-sm text-gray-700 dark:text-gray-300"},O={key:1,class:"text-sm text-gray-700 dark:text-gray-300"},Q={key:2,class:"text-sm text-yellow-700 dark:text-yellow-300 mt-2"},W={key:2,class:"mb-6"},X=["disabled"],Y={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Z={key:3,class:"mb-6"},$={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},ee={class:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800"},te={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},le={class:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800"},se={class:"text-2xl font-bold text-green-600 dark:text-green-400"},ae={class:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800"},re={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},oe={class:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800"},ie={class:"text-2xl font-bold text-red-600 dark:text-red-400"},ne={key:0,class:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"},de={class:"font-semibold mb-2 text-gray-900 dark:text-white capitalize"},ue={class:"grid grid-cols-4 gap-2 text-sm"},ce={class:"font-bold"},pe={class:"font-bold"},be={class:"font-bold"},ge={class:"font-bold text-red-600"},ve={key:4,class:"flex flex-col md:flex-row gap-4 mb-6"},ye=["disabled"],xe={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},me=["disabled"],fe={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},ke=["disabled"],_e={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},he={key:5,class:"mb-6"},ze={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4"},we={class:"text-sm text-gray-600 dark:text-gray-400 mt-2 text-center"},Se={__name:"Sync",setup(Ce){const r=b("http"),y=b(!1),u=b(!1),g=b(null),k=b(0),c=b(null),p=b(null),o=b(null);F(async()=>{r.value!=="http"&&await _()});const _=async()=>{if(r.value!=="http")try{const n=await V.get("/sync/status");n.data.success&&(p.value=n.data.data)}catch(n){console.error("Errore nel caricamento stato sync:",n)}};D(r,async n=>{n==="http"?(p.value=null,c.value=null,o.value={type:"info",text:"Con la modalitÃ  HTTP, usa l'app Flutter per sincronizzare i dati."}):await _()});const A=async()=>{var n,t;if(r.value==="http"){o.value={type:"info",text:"Con la modalitÃ  HTTP, usa l'app Flutter per calcolare le differenze e sincronizzare."};return}y.value=!0,o.value=null;try{o.value={type:"info",text:"Per modalitÃ  ADB, usa lo script sync_via_adb.sh sul server."}}catch(x){o.value={type:"error",text:((t=(n=x.response)==null?void 0:n.data)==null?void 0:t.message)||"Errore nel calcolo delle differenze"}}finally{y.value=!1}},M=async()=>{if(r.value==="http"){o.value={type:"info",text:"Con la modalitÃ  HTTP, usa l'app Flutter per sincronizzare i dati."};return}o.value={type:"info",text:"Per modalitÃ  ADB, usa lo script sync_via_adb.sh push sul server."}},P=async()=>{if(r.value==="http"){o.value={type:"info",text:"Con la modalitÃ  HTTP, usa l'app Flutter per sincronizzare i dati."};return}o.value={type:"info",text:"Per modalitÃ  ADB, usa lo script sync_via_adb.sh pull sul server."}},B=async()=>{if(r.value==="http"){o.value={type:"info",text:"Con la modalitÃ  HTTP, usa l'app Flutter per sincronizzare i dati."};return}o.value={type:"info",text:"Per modalitÃ  ADB, usa lo script sync_via_adb.sh merge sul server."}},H=n=>n?new Date(n).toLocaleString("it-IT"):"N/A";return(n,t)=>{var x,h,z,w;return a(),s("div",q,[e("div",E,[t[21]||(t[21]=e("h1",{class:"text-3xl font-bold mb-6 text-gray-900 dark:text-white"}," Sincronizzazione Database ",-1)),e("div",R,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ModalitÃ  Sincronizzazione ",-1)),e("div",L,[e("label",I,[C(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=i=>r.value=i),value:"http",class:"mr-2"},null,512),[[T,r.value]]),t[2]||(t[2]=e("span",{class:"text-gray-700 dark:text-gray-300"},"Rete HTTP",-1))]),e("label",G,[C(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=i=>r.value=i),value:"adb",class:"mr-2"},null,512),[[T,r.value]]),t[3]||(t[3]=e("span",{class:"text-gray-700 dark:text-gray-300"},"USB ADB",-1))])])]),r.value==="http"?(a(),s("div",J,[...t[5]||(t[5]=[N('<h3 class="font-semibold mb-2 text-blue-900 dark:text-blue-100">ModalitÃ  HTTP</h3><p class="text-sm text-blue-700 dark:text-blue-300 mb-3"> Con la modalitÃ  HTTP, usa l&#39;app Flutter Android per sincronizzare i dati. </p><div class="bg-white dark:bg-gray-800 p-4 rounded-lg border border-blue-200 dark:border-blue-700"><h4 class="font-semibold mb-2 text-blue-900 dark:text-blue-100">Come sincronizzare dall&#39;app Flutter:</h4><ol class="list-decimal list-inside space-y-2 text-sm text-blue-700 dark:text-blue-300"><li>Apri l&#39;app Flutter sul tuo telefono Android</li><li>Nella schermata principale (lista persone), clicca sull&#39;icona <strong>ðŸ”„ Sincronizza</strong> in alto a destra</li><li>Seleziona la modalitÃ  <strong>&quot;Rete HTTP&quot;</strong></li><li>Clicca su <strong>&quot;Calcola Differenze&quot;</strong> per vedere cosa Ã¨ cambiato</li><li>Scegli l&#39;azione desiderata: <ul class="list-disc list-inside ml-4 mt-1"><li><strong>Copia App â†’ Server</strong>: invia i dati dal telefono al server</li><li><strong>Copia Server â†’ App</strong>: scarica i dati dal server al telefono</li><li><strong>Unisci (Merge)</strong>: unisce i dati da entrambe le parti</li></ul></li></ol></div><p class="text-xs text-blue-600 dark:text-blue-400 mt-3"> ðŸ’¡ Il frontend web funziona solo come dashboard di monitoraggio per la modalitÃ  ADB. </p>',4)])])):d("",!0),p.value&&r.value!=="http"?(a(),s("div",{key:1,class:f(["mb-6 p-4 rounded-lg",p.value.pending_conflicts>0?"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800":"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800"])},[t[6]||(t[6]=e("h3",{class:"font-semibold mb-2 text-gray-900 dark:text-white"},"Ultima Sincronizzazione",-1)),p.value.last_sync?(a(),s("p",K," Tipo: "+l(p.value.last_sync.sync_type)+" | ModalitÃ : "+l(p.value.last_sync.sync_mode)+" | Completata: "+l(H(p.value.last_sync.completed_at))+" | Record sincronizzati: "+l(p.value.last_sync.records_synced),1)):(a(),s("p",O," Nessuna sincronizzazione effettuata ")),p.value.pending_conflicts>0?(a(),s("p",Q," âš ï¸ "+l(p.value.pending_conflicts)+" conflitti in attesa di risoluzione ",1)):d("",!0)],2)):d("",!0),r.value==="adb"?(a(),s("div",W,[t[8]||(t[8]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-3"},[v(" Con la modalitÃ  ADB, esporta i dati dall'app Flutter e usa lo script "),e("code",{class:"bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded"},"./sync_via_adb.sh"),v(" sul server. ")],-1)),e("button",{onClick:A,disabled:y.value||u.value,class:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[y.value?(a(),s("svg",Y,[...t[7]||(t[7]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):d("",!0),e("span",null,l(y.value?"Calcolo differenze...":"Calcola Differenze"),1)],8,X)])):d("",!0),c.value&&r.value==="adb"?(a(),s("div",Z,[t[17]||(t[17]=e("h2",{class:"text-2xl font-bold mb-4 text-gray-900 dark:text-white"},"Differenze Trovate",-1)),e("div",$,[e("div",ee,[t[9]||(t[9]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Nuovi sul Server",-1)),e("div",te,l(((x=c.value.summary)==null?void 0:x.server_new)||0),1)]),e("div",le,[t[10]||(t[10]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Nuovi sull'App",-1)),e("div",se,l(((h=c.value.summary)==null?void 0:h.app_new)||0),1)]),e("div",ae,[t[11]||(t[11]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Modificati",-1)),e("div",re,l(((z=c.value.summary)==null?void 0:z.modified)||0),1)]),e("div",oe,[t[12]||(t[12]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Conflitti",-1)),e("div",ie,l(((w=c.value.summary)==null?void 0:w.conflicts)||0),1)])]),(a(!0),s(S,null,U(c.value,(i,m)=>(a(),s(S,{key:m},[m!=="summary"&&i&&typeof i=="object"&&(i.server_new_count>0||i.app_new_count>0||i.modified_count>0||i.conflicts_count>0)?(a(),s("div",ne,[e("h3",de,l(m),1),e("div",ue,[e("div",null,[t[13]||(t[13]=v("Server nuovi: ",-1)),e("span",ce,l(i.server_new_count||0),1)]),e("div",null,[t[14]||(t[14]=v("App nuovi: ",-1)),e("span",pe,l(i.app_new_count||0),1)]),e("div",null,[t[15]||(t[15]=v("Modificati: ",-1)),e("span",be,l(i.modified_count||0),1)]),e("div",null,[t[16]||(t[16]=v("Conflitti: ",-1)),e("span",ge,l(i.conflicts_count||0),1)])])])):d("",!0)],64))),128))])):d("",!0),c.value&&r.value==="adb"?(a(),s("div",ve,[e("button",{onClick:M,disabled:u.value||!c.value,class:"flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[u.value&&g.value==="push"?(a(),s("svg",xe,[...t[18]||(t[18]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):d("",!0),e("span",null,l(u.value&&g.value==="push"?"Sincronizzazione...":"Copia App â†’ Server"),1)],8,ye),e("button",{onClick:P,disabled:u.value||!c.value,class:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[u.value&&g.value==="pull"?(a(),s("svg",fe,[...t[19]||(t[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):d("",!0),e("span",null,l(u.value&&g.value==="pull"?"Sincronizzazione...":"Copia Server â†’ App"),1)],8,me),e("button",{onClick:B,disabled:u.value||!c.value,class:"flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2"},[u.value&&g.value==="merge"?(a(),s("svg",_e,[...t[20]||(t[20]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):d("",!0),e("span",null,l(u.value&&g.value==="merge"?"Merge in corso...":"Merge Tutto"),1)],8,ke)])):d("",!0),u.value?(a(),s("div",he,[e("div",ze,[e("div",{class:"bg-blue-600 h-4 rounded-full transition-all duration-300",style:j({width:k.value+"%"})},null,4)]),e("p",we,l(k.value)+"% completato",1)])):d("",!0),o.value?(a(),s("div",{key:6,class:f(["mb-6 p-4 rounded-lg",o.value.type==="success"?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800"])},[e("p",{class:f(o.value.type==="success"?"text-green-800 dark:text-green-200":"text-red-800 dark:text-red-200")},l(o.value.text),3)],2)):d("",!0)])])}}};export{Se as default};
